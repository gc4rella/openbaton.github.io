<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>OpenBaton Documentation</title>
  

  <link rel="shortcut icon" href="favicon.ico">
  

  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,400,300,600,700" rel="stylesheet" type="text/css">

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "The Event Mechanism tutorial";
    var mkdocs_page_input_path = "how-to-register-event.md";
    var mkdocs_page_url = "/how-to-register-event/";
     var mkdocs_page_url = "/how-to-register-event/";
  </script>
  
  <!-- site_name == OpenBaton Documentation -->
  <!-- page_title == The Event Mechanism tutorial -->
  <!-- base_url == .. -->
  <!-- current_page == The Event Mechanism tutorial - /how-to-register-event/ [*]
 -->
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-68429895-1', 'openbaton.github.io');
      ga('send', 'pageview');
  </script>
  

<style>

.subnav_drop{
  cursor: pointer;


}

ul.subnav {
/*display:none ;*/
cursor: pointer;
border-bottom: 1px solid #e1e1e5;
}

.subnav:last-child{
  border-bottom: none;

}

ul.subnav:active {
display:block;
}

.wy-menu-vertical li ul {
display: block;

  }

</style>
</head>

<body role="document">

<script type="text/javascript">
$( document).ready(function(){
      //console.log("test");

    //$('.subnav').not( ":has('The Event Mechanism tutorial')" ).hide();
    $('li.subnav_drop').find('ul.subnav').hide();
    //$('li.subnav_drop').find('ul.subnav').each(function(i,e){console.log(i,e)});
       $( ".subnav" ).find( "li:contains('The Event Mechanism tutorial')" ).each(function(i,e){
          var currentElement = $(e);
          currentElement.parent().css({"display":"block","visibility":"visible"}); //css("background-color","blue");
          currentElement.css({"display":"block","visibility":"visible"});
       });//$( ".subnav" ).find( "li:contains('The Event Mechanism tutorial')" ).css("display","block");
       //$(".current").css({"background-color":"blue","display":"block","visibility":"visible"});
       //show(1000,function(i,e){console.log(i,e)});
       //$('li.subnav_drop').find('ul.subnav').css("background-color","blue");
      //$(this).find('ul.subnav').toggle();
    $('li.subnav_drop').click(function(i,e) {  
      $('li.subnav_drop').not(this).find('ul.subnav').hide();
      $(this).find('ul.subnav').toggle();
    }); 

});
   
$( ".wy-nav-content" ).find( "li:contains('The Event Mechanism tutorial')" ).css('color','red');
console.log('--------');
console.log($( ".wy-nav-content" ).find( "div:contains('The Event Mechanism tutorial')" ).css("color","red"));
console.log('--------');
console.log($( ".subnav" ).find( "li:contains('The Event Mechanism tutorial')" ));
console.log('--------');
  </script>



<div class="navcontainer" style="margin:0px; background:#000;">
    <div class="navholder">
      <nav>
        <a href="../../index.html" class="logo"></a>
        <a href="#" id="menu-icon"></a>
        <ul class="navigation">
          
                <li><a href="../../index.html#about">About</a></li>
                <li><a href="../../cases.html">Use Cases</a></li>
                <li><a href="../../features.html">Features</a></li>
                <li><a href="#">Documentation</a></li>
                <li><a href="../../index.html#contact">Contact</a></li>
                <li><a href="http://marketplace.openbaton.org"><i class="material-icons">shopping_cart </i>  Marketplace<div class="ripple-container"></div></a></li>
          </ul>
      </nav>
     </div>
</div>
<div  class="container">
  <div class="holder"> 
        <div class="wy-grid-for-nav">

          
          <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
              <ul class="current">
                
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Get Started</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="..">Get Started</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Installation</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-installation/">Overview</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-installation-deb/">Install on Linux</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-installation-mac/">Install on MacOS</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-installation-docker/">Install with Docker</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-installation-vagrant/">Install with Vagrant</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-configuration/">Configure it</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>NFV Orchestrator</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../use/">NFVO intro</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../security/">Identity management</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-how-to-use-gui/">Use via the Dashboard</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-how-to-use-cli/">Use via the CLI</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../vim-instance/">Register a PoP</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../vnf-package/">VNF Packages</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../ns-descriptor/">Network Service Descriptor</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>VIM Driver</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../vim-driver/">VIM Driver Overview</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>VNF Managers</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../vnfm-intro/">VNFM intro</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../vnfm-generic/">Generic VNFM</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../vnfm-juju/">Juju VNFM</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../vnfm-how-to-write/">Develop a VNFM</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../vnfm-vendor-specific/">Integrate your own VNFM</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Monitoring</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../monitoring/">Monitoring overview</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../zabbix-plugin/">Zabbix plugin</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Autoscaling</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../autoscaling/">Autoscaling overview</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Fault Management</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../fault-management/">FM overview</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Network Slicing</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../network-slicing/">NS overview</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Marketplace</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../marketplace/">Marketplace overview</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Tutorials</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../tutorial/">Tutorials overview</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../dummy-NSR/">Dummy NSR</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../iperf-NSR/">Iperf Scenario</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../tutorial-sipp/">SIPp example</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../ims-NSR/">OpenIMSCore example</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../tutorial-juju/">OpenIMSCore with Juju VNFM</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../fms-sipp-tutorial/">Fault Management System</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../integration-test-use/">Integration Tests</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Learn more</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-architecture/">NFVO Architecture</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../vim-driver-create/">Create a VIM Driver</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-sdk/">Open Baton SDKs</a>
        
    </li>


        
             

    <li class="toctree-l1 current">
        <a class="current" href="./">The Event Mechanism tutorial</a>
        
         
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>FAQ</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../FAQ/">FAQ</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
              </ul>
            </div>
            &nbsp;
          </nav>
        </div>
    <div class="content_container">
        <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

         

          
                <div class="wy-nav-content">
                  <div class="rst-content">
                   
                    <div role="main">
                      <div class="section">
                        
                          <h1 id="how-to-register-to-nfvo-events">How to register to NFVO Events</h1>
<p>The Open Baton platform can be easily extended by writing new external modules that can "react" on some events happening in the system. We already showed how to trigger some operations to the NFVO in the page regarding the <a href="../nfvo-sdk">NFVO sdk</a>. In this short tutorial we will show how to write an external module aware of the NFV environment managed by Open Baton. The NFVO sdk already gives the tools for registering to events, so the first steps are the same of the <a href="../nfvo-sdk">NFVO sdk</a> page.</p>
<p>Inside the project folder create a <em>build.gradle</em> file as follows:</p>
<pre><code class="gradle">group 'org.openbaton'
version '1.0-SNAPSHOT'

apply plugin: 'java'

repositories {
    mavenCentral()
    /**
     * Only needed for openbaton snapshots dependencies
     */
    maven {
        url 'https://oss.sonatype.org/content/repositories/snapshots/'
    }
}

dependencies {
    compile 'org.openbaton:sdk:3.2.0'
}
</code></pre>

<p>The main idea behind the event mechanism is that you can register the endpoint where you want to receive the event. We are supporting at the moment two different kind of endpoint, ReST or Amqp. In this example we are using the ReST type. For doing that you need to create <em>EventEndpoint</em> object to be sent to the NFVO using the NFVORequestor. In the project folder create a .java as the following example.</p>
<pre><code class="java">package org.openbaton.event.module.main;

import org.openbaton.catalogue.nfvo.Action;
import org.openbaton.catalogue.nfvo.EndpointType;
import org.openbaton.catalogue.nfvo.EventEndpoint;
import org.openbaton.sdk.NFVORequestor;
import org.openbaton.sdk.api.exception.SDKException;
import org.openbaton.sdk.api.rest.EventAgent;

/**
 * Created by lto on 26/09/16.
 */
public class EventModule {

  /**
   * This is the Username used to connect to the NFVO
   */
  private static String obUsername = &quot;admin&quot;;
  /**
   * This is the Password used to connect to the NFVO
   */
  private static String obPassword = &quot;openbaton&quot;;
  /**
   * This is the Project ID used to connect to the NFVO
   */
  private static String obProjectId = &quot;cef9283a-de4b-47e3-a221-d1192ce9e5bd&quot;;
  /**
   * This must be true if during the NFVO installation the ssl was enabled
   */
  private static boolean isSslEnabled = false;
  /**
   * This is the NFVO Ip
   */
  private static String obNfvoIp = &quot;127.0.0.1&quot;;
  /**
   * This is the NFVO port
   */
  private static String obNfvoPort = &quot;8080&quot;;

  public static void main(String[] args) {

    NFVORequestor
        requestor =
        new NFVORequestor(obUsername, obPassword, obProjectId, isSslEnabled, obNfvoIp, obNfvoPort, &quot;1&quot;);

    /*
      Now the Event Agent needs to be retrieved
     */
    EventAgent eventAgent = requestor.getEventAgent();

    /*
      Define your endpoint
     */
    EventEndpoint eventEndpoint = new EventEndpoint();
    eventEndpoint.setName(&quot;MyEvent&quot;);
    eventEndpoint.setDescription(&quot;My event endpoint&quot;);

    /*
      Register to all the event describing the correct instantiation of NSR
     */
    eventEndpoint.setEvent(Action.INSTANTIATE_FINISH);
    eventEndpoint.setType(EndpointType.REST);
    eventEndpoint.setEndpoint(&quot;http://127.0.0.1/event/module&quot;);

    /*
    It is also possible to filter the event based on the NSR id or the VNFR id. Putting to null means you want to
    receive events for all NSR or VNFR. Please consider that the events refer or to a NSR or to a VNFR so you can
    only filter by NSR id the events that are related to NSR, same for the VNFRs.
     */
    eventEndpoint.setNetworkServiceId(null);
    eventEndpoint.setVirtualNetworkFunctionId(null);

    /*
      Now register the endpoint
     */
    try {
      eventAgent.create(eventEndpoint);
    } catch (SDKException e) {
      e.printStackTrace();
      System.err.println(&quot;Got an exception :(&quot;);
    }
  }
}

</code></pre>

<p>As written in the comment, some events are related only to NSR and some other only to the VNFR. The following table describes all the events:</p>
<table>
<thead>
<tr>
<th>Event Type (Action)</th>
<th align="center">NSR or VNFR related (or both)</th>
<th align="right">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>GRANT_OPERATION</td>
<td align="center">VNFR</td>
<td align="right">The VNFR has finished the GRANT_OPERATION action</td>
</tr>
<tr>
<td>SCALE_IN</td>
<td align="center">VNFR</td>
<td align="right">The VNFR has finished the SCALE_IN action</td>
</tr>
<tr>
<td>SCALE_OUT</td>
<td align="center">VNFR</td>
<td align="right">The VNFR has finished the SCALE_OUT action</td>
</tr>
<tr>
<td>ERROR</td>
<td align="center">Both</td>
<td align="right">The VNFR or NSR went in ERROR state</td>
</tr>
<tr>
<td>INSTANTIATE</td>
<td align="center">VNFR</td>
<td align="right">The VNFR has finished the INSTANTIATE action</td>
</tr>
<tr>
<td>MODIFY</td>
<td align="center">VNFR</td>
<td align="right">The VNFR has finished the MODIFY action</td>
</tr>
<tr>
<td>HEAL</td>
<td align="center">Both</td>
<td align="right">The VNFR has finished the HEAL action or the NSR has completed the healing procedure</td>
</tr>
<tr>
<td>SCALED</td>
<td align="center">Both</td>
<td align="right">The VNFR has finished the SCALE_IN or SCALE_OUT action or the NSR has completed the scaling procedure</td>
</tr>
<tr>
<td>RELEASE_RESOURCES_FINISH</td>
<td align="center">NSR</td>
<td align="right">The NSR is completely removed</td>
</tr>
<tr>
<td>INSTANTIATE_FINISH</td>
<td align="center">NSR</td>
<td align="right">The NSR is correctly instantiated</td>
</tr>
<tr>
<td>START</td>
<td align="center">VNFR</td>
<td align="right">The VNFR has finished the START action</td>
</tr>
<tr>
<td>STOP</td>
<td align="center">VNFR</td>
<td align="right">The VNFR has finished the STOP action</td>
</tr>
</tbody>
</table>
<p>If the event is related to the NSR in the event payload you will receive the NSR object else you will receive the related VNFR. An example of ReST web server based on <a href="https://spring.io/guides/gs/rest-service/">Spring</a> follows.</p>
<pre><code class="java">package org.openbaton.event.module.rest;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import com.google.gson.JsonObject;

import org.openbaton.catalogue.mano.record.NetworkServiceRecord;
import org.openbaton.catalogue.mano.record.VirtualNetworkFunctionRecord;
import org.openbaton.catalogue.nfvo.Action;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;

/**
 * Created by lto on 26/09/16.
 */
@RestController
@RequestMapping(&quot;/event/module&quot;)
public class RestApi {

  private Gson gson = new GsonBuilder().setPrettyPrinting().create();

  @RequestMapping(method = RequestMethod.POST, consumes = MediaType.APPLICATION_JSON_VALUE)
  public void receiveEvent(@RequestBody String msg){
    JsonObject event = new JsonParser().parse(msg).getAsJsonObject();
    System.out.println(&quot;Received event from NFVO:\n&quot; + event);
    String action = event.get(&quot;action&quot;).getAsString();
    System.out.println(&quot;The action is: &quot; + action);

    switch (Action.valueOf(action)) {
      case INSTANTIATE_FINISH: // this event is only related to NSR
        NetworkServiceRecord networkServiceRecord = gson.fromJson(event.get(&quot;payload&quot;).getAsJsonObject(), NetworkServiceRecord.class);
        break;
      case START:
        VirtualNetworkFunctionRecord virtualNetworkFunctionRecord = gson.fromJson(event.get(&quot;payload&quot;).getAsJsonObject(), VirtualNetworkFunctionRecord.class);
        break;
    }

    /**
     * execute the module business logic
     */
  }
}
</code></pre>

<p>As shown in the example class, the payload is a json string converted to the NetworkServiceRecord or VirtualNetworkFunctionRecord depending on the event. Another note is that the NFVO calls a POST on the specified eventEndpoint (in this case "http://172.0.0.1/event/module"), for that reason the RestApi example class is listening on that path for a POST method.</p>
                        
                      </div>
                    </div>
                    <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../FAQ/" class="btn btn-neutral float-right" title="FAQ">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../nfvo-sdk/" class="btn btn-neutral" title="Open Baton SDKs"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright (c) 2016 Open Baton (http://www.openbaton.org)</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          	  
                  </div>
                </div>

        </section>
    </div>
  </div>
</div>



</body>
</html>

