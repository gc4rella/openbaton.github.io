<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>OpenBaton Documentation</title>
  

  <link rel="shortcut icon" href="favicon.ico">
  

  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,400,300,600,700" rel="stylesheet" type="text/css">

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Zabbix plugin";
    var mkdocs_page_input_path = "zabbix-plugin.md";
    var mkdocs_page_url = "/zabbix-plugin/";
     var mkdocs_page_url = "/zabbix-plugin/";
  </script>
  
  <!-- site_name == OpenBaton Documentation -->
  <!-- page_title == Zabbix plugin -->
  <!-- base_url == .. -->
  <!-- current_page == Zabbix plugin - /zabbix-plugin/ [*]
 -->
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-68429895-1', 'openbaton.github.io');
      ga('send', 'pageview');
  </script>
  

<style>

.subnav_drop{
  cursor: pointer;


}

ul.subnav {
/*display:none ;*/
cursor: pointer;
border-bottom: 1px solid #e1e1e5;
}

.subnav:last-child{
  border-bottom: none;

}

ul.subnav:active {
display:block;
}

.wy-menu-vertical li ul {
display: block;

  }

</style>
</head>

<body role="document">

<script type="text/javascript">
$( document).ready(function(){
      //console.log("test");

    //$('.subnav').not( ":has('Zabbix plugin')" ).hide();
    $('li.subnav_drop').find('ul.subnav').hide();
    //$('li.subnav_drop').find('ul.subnav').each(function(i,e){console.log(i,e)});
       $( ".subnav" ).find( "li:contains('Zabbix plugin')" ).each(function(i,e){
          var currentElement = $(e);
          currentElement.parent().css({"display":"block","visibility":"visible"}); //css("background-color","blue");
          currentElement.css({"display":"block","visibility":"visible"});
       });//$( ".subnav" ).find( "li:contains('Zabbix plugin')" ).css("display","block");
       //$(".current").css({"background-color":"blue","display":"block","visibility":"visible"});
       //show(1000,function(i,e){console.log(i,e)});
       //$('li.subnav_drop').find('ul.subnav').css("background-color","blue");
      //$(this).find('ul.subnav').toggle();
    $('li.subnav_drop').click(function(i,e) {  
      $('li.subnav_drop').not(this).find('ul.subnav').hide();
      $(this).find('ul.subnav').toggle();
    }); 

});
   
$( ".wy-nav-content" ).find( "li:contains('Zabbix plugin')" ).css('color','red');
console.log('--------');
console.log($( ".wy-nav-content" ).find( "div:contains('Zabbix plugin')" ).css("color","red"));
console.log('--------');
console.log($( ".subnav" ).find( "li:contains('Zabbix plugin')" ));
console.log('--------');
  </script>



<div class="navcontainer" style="margin:0px; background:#000;">
    <div class="navholder">
      <nav>
        <a href="../../index.html" class="logo"></a>
        <a href="#" id="menu-icon"></a>
        <ul class="navigation">
          
                <li><a href="../../index.html#about">About</a></li>
                <li><a href="../../cases.html">Use Cases</a></li>
                <li><a href="../../features.html">Features</a></li>
                <li><a href="#">Documentation</a></li>
                <li><a href="../../index.html#contact">Contact</a></li>
                <li><a href="http://marketplace.openbaton.org"><i class="material-icons">shopping_cart </i>  Marketplace<div class="ripple-container"></div></a></li>
          </ul>
      </nav>
     </div>
</div>
<div  class="container">
  <div class="holder"> 
        <div class="wy-grid-for-nav">

          
          <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
              <ul class="current">
                
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Get Started</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="..">Get Started</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Installation</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-installation/">Overview</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-installation-deb/">Install on Linux</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-installation-mac/">Install on MacOS</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-installation-docker/">Install with Docker</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-installation-vagrant/">Install with Vagrant</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-configuration/">Configure it</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>NFV Orchestrator</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../use/">NFVO intro</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../security/">Identity management</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-how-to-use-gui/">Use via the Dashboard</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-how-to-use-cli/">Use via the CLI</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../vim-instance/">Register a PoP</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../vnf-package/">VNF Packages</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../ns-descriptor/">Network Service Descriptor</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>VIM Driver</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../vim-driver/">VIM Driver Overview</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>VNF Managers</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../vnfm-intro/">VNFM intro</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../vnfm-generic/">Generic VNFM</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../vnfm-juju/">Juju VNFM</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../vnfm-how-to-write/">Develop a VNFM</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../vnfm-vendor-specific/">Integrate your own VNFM</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Monitoring</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../monitoring/">Monitoring overview</a>
        
    </li>


        
             

    <li class="toctree-l1 current">
        <a class="current" href="./">Zabbix plugin</a>
        
         
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Autoscaling</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../autoscaling/">Autoscaling overview</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Fault Management</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../fault-management/">FM overview</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Network Slicing</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../network-slicing/">NS overview</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Marketplace</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../marketplace/">Marketplace overview</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Tutorials</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../tutorial/">Tutorials overview</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../dummy-NSR/">Dummy NSR</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../iperf-NSR/">Iperf Scenario</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../tutorial-sipp/">SIPp example</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../ims-NSR/">OpenIMSCore example</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../tutorial-juju/">OpenIMSCore with Juju VNFM</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../fms-sipp-tutorial/">Fault Management System</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../integration-test-use/">Integration Tests</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>Learn more</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-architecture/">NFVO Architecture</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../vim-driver-create/">Create a VIM Driver</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../nfvo-sdk/">Open Baton SDKs</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../how-to-register-event/">The Event Mechanism tutorial</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
                  <li><ul> 
    
   
    <li class="subnav_drop"><span>FAQ</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../FAQ/">FAQ</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
                 
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
              </ul>
            </div>
            &nbsp;
          </nav>
        </div>
    <div class="content_container">
        <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

         

          
                <div class="wy-nav-content">
                  <div class="rst-content">
                   
                    <div role="main">
                      <div class="section">
                        
                          <h1 id="zabbix-plugin">Zabbix plugin</h1>
<p>Zabbix plugin (see it on <a href="https://github.com/openbaton/zabbix-plugin">GitHub</a>) is an open source project providing a reference implementation of two interfaces of the VIM, based on the ETSI <a href="http://www.etsi.org/deliver/etsi_gs/NFV-MAN/001_099/001/01.01.01_60/gs_nfv-man001v010101p.pdf">NFV MANO</a> specification.</p>
<p>The two interfaces are:<br />
-   VirtualisedResourceFaultManagement<br />
-   VirtualisedResourcePerformanceManagement</p>
<p>A detailed description of the interfaces is in the last ETSI Draft <a href="http://www.etsi.org/deliver/etsi_gs/NFV-IFA/001_099/005/02.01.01_60/gs_nfv-ifa005v020101p.pdf">IFA005_Or-Vi_ref_point_Spec</a>.<br />
In particular with the Zabbix plugin you can create/delete items, trigger and action on-demand. </p>
<p><img alt="Zabbix plugin architecture" src="../images/zabbix-plugin-architecture.png" /></p>
<p>Some of the benefits introduced by the usage of such plugin:<br />
1) Make the consumers (NFVO, VNFM) indipendent to the monitoring system.<br />
2) The communication between the consumers and zabbix-plugin is JSON based, so the consumers can be written in any languages.<br />
3) The values of the items are cached and updated periodically in order to avoid to contact the zabbix server each time a specific metric is required.<br />
4) If your consumer is written in java, we provide a simple class MonitoringPluginCaller which handle the communication via RabbitMQ.  </p>
<h3 id="prerequisites">Prerequisites</h3>
<p>The prerequisites are:  </p>
<ul>
<li>Zabbix server (2.2 or 3.0) installed and running. See <a href="../zabbix-server-configuration-2.2/">how to configure Zabbix server 2.2</a> or <a href="../zabbix-server-configuration-3.0/">Zabbix server 3.0</a>.</li>
<li>RabbitMQ server installed and running  </li>
<li>Git installed</li>
<li>Gradle installed</li>
</ul>
<h2 id="additional-zabbix-server-configuration-required-for-receiving-notifications">Additional Zabbix Server configuration required for receiving notifications</h2>
<p>If you are going to use Open Baton FM system or you wish to use the createThreshold method, you need this additional configuration.<br />
Create a script called "send_notification.sh" with the following content.</p>
<pre><code class="bash">#!/bin/bash
to=$1
body=$3
curl -X POST -H &quot;Accept: application/json&quot; -H &quot;Content-Type: application/json&quot; -d &quot;$body&quot; http://$to
</code></pre>

<p>The variable 'to' is the endpoint where zabbix-plugin receives the notification (specified in <strong>notification-receiver-server-context</strong> property). 
Copy the following script in the Zabbix Server machine. In particular, in a special directory defined in the Zabbix Server configuration file (/etc/zabbix/zabbix_server.conf) as AlertScriptsPath variable. If the value of the variable AlertScriptsPath is for example "/usr/lib/zabbix/alertscripts", 
then copy the send_notification.sh script just created in that folder.<br />
Once you are in the directory "/usr/lib/zabbix/alertscripts", add executable permissions to the script running the command:</p>
<pre><code class="bash">sudo chmod +x send_notification.sh
</code></pre>

<p><em>Note</em>: when you will use the method createThreshold, Zabbix Plugin will configure Zabbix Server automatically in order to use the script "send_notification.sh". 
What it will try to do is the configuration at this page <a href="https://www.zabbix.com/documentation/2.2/manual/config/notifications/media/script">custom alertscripts</a>. 
If for any reason this auto-configuration won't work, you will see in the Zabbix Plugin logs, then you should execute this configuration manually as explained in the Zabbix documentation.</p>
<h2 id="notification-mechanism">Notification mechanism</h2>
<p>How does Zabbix plugin receive notifications from the Zabbix Server? </p>
<p>When using the method createThreshold provided by the plugin, it automatically creates an <a href="https://www.zabbix.com/documentation/2.2/manual/config/notifications/action">action</a> executed when the specific condition is met. 
If the threshold is crossed (the status of the trigger goes from OK to PROBLEM or viceversa) the action is performed. The action gets the informations of the threshold and sends them to a custom alertScript.
The custom alertscripts is executed on the Zabbix Server and its task is to send the information received from the action to the Zabbix plugin. </p>
<p>Zabbix plugin waits for notifications at the url: http://zabbix-plugin-ip:defaultPort/defaultContext.</p>
<p>Defatult context and ports are specified in the configuration file as: 
<em> <strong>notification-receiver-server-context</strong>.
</em> <strong>notification-receiver-server-port</strong>.</p>
<h3 id="installation">Installation</h3>
<p>Once the prerequisites are met, you can clone the following project from git, compile it using gradle and launch it:  </p>
<pre><code class="bash">git clone https://github.com/openbaton/zabbix-plugin.git
cd zabbix-plugin
./gradlew build -x test
java -jar build/lib/openbaton-plugin-monitoring-zabbix-&lt;version&gt;.jar
</code></pre>

<h3 id="configuration">Configuration</h3>
<p>If the prerequisites are met you should already have the folder "/etc/openbaton". Then copy the configuration file in src/main/resources/plugin.conf.properties to the path /etc/openbaton/ with the name openbaton-plugin-monitoring-zabbix.properties. Once you are inside the zabbix-plugin directory type this command:</p>
<pre><code class="bash">cp src/main/resources/plugin.conf.properties /etc/openbaton/openbaton-plugin-monitoring-zabbix.properties
</code></pre>

<p>The configuration parameters are explained in the following table.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>zabbix-plugin-ip</td>
<td>IP of the Zabbix Plugin machine</td>
<td>localhost</td>
</tr>
<tr>
<td>zabbix-host</td>
<td>IP of the Zabbix Server</td>
<td>localhost</td>
</tr>
<tr>
<td>zabbix-port</td>
<td>Port of the Zabbix Server</td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>The type of the plugin</td>
<td>zabbix-plugin</td>
</tr>
<tr>
<td>user-zbx</td>
<td>User of the Zabbix Server</td>
<td>Admin</td>
</tr>
<tr>
<td>password-zbx</td>
<td>Password of Zabbix Server</td>
<td>zabbix</td>
</tr>
<tr>
<td>zabbix-server-version</td>
<td>Zabbix Server version</td>
<td>3.0</td>
</tr>
<tr>
<td>client-request-frequency</td>
<td>Update cache period (Basically each time t, Zabbix Plugin ask to every items value for all hosts and fill the local cache). Set 0 to disable it</td>
<td>10 (seconds)</td>
</tr>
<tr>
<td>history-length</td>
<td>How long is the history. If the client-request-frequency is 10 seconds and history-length 100, we have available the value of the items of the previous 1000 seconds.</td>
<td>250</td>
</tr>
<tr>
<td>notification-receiver-server-context</td>
<td>Context where the zabbix-plugin receive the notifications by the zabbix server. (see the section 'How to configure Zabbix to get notifications')</td>
<td>/zabbixplugin/notifications</td>
</tr>
<tr>
<td>notification-receiver-server-port</td>
<td>Port where the zabbix-plugin receive the notifications by the zabbix server.</td>
<td>8010</td>
</tr>
<tr>
<td>external-properties-file</td>
<td>Full path of the configuration file.</td>
<td>/etc/openbaton/openbaton-plugin-monitoring-zabbix.properties</td>
</tr>
</tbody>
</table>
<p>The configuration file should look like the one below:</p>
<pre><code class="bash">## Zabbix Plugin

zabbix-plugin-ip=localhost
# Set client-request-frequency to 0 to disable the caching
type=zabbix-plugin
client-request-frequency=10
history-length=250
notification-receiver-server-context=/zabbixplugin/notifications
notification-receiver-server-port=8010
external-properties-file=/etc/openbaton/openbaton-plugin-monitoring-zabbix.properties

## Zabbix Server info

zabbix-host=localhost
# zabbix-port=
user-zbx=Admin
password-zbx=zabbix
# Supported Zabbix versions: 2.2 and 3.0
zabbix-server-version=3.0
</code></pre>

<h2 id="using-it-via-monitoringplugincaller">Using it via MonitoringPluginCaller</h2>
<p>In order to use the MonitorPluginCaller you need to import the relative plugin-sdk, coming from <a href="http://openbaton.github.io">Openbaton</a> project.
To import the plugin-sdk, please add in your gradle file the following dependencies:</p>
<pre><code>repositories {
       maven { url 'https://oss.sonatype.org/content/repositories/snapshots/' }
       maven { url 'https://oss.sonatype.org/content/repositories/releases/'  }
}

dependencies {
    compile 'org.openbaton:monitoring:3.2.1-SNAPSHOT'
}
</code></pre>

<p>Then in your main, obtain the MonitoringPluginCaller as follow:</p>
<pre><code class="java">MonitoringPluginCaller monitoringPluginCaller = null;
    try {
      monitoringPluginCaller =
          new MonitoringPluginCaller(
              &quot;brokerIp&quot;, &quot;username&quot;, &quot;password&quot;, 5601, &quot;zabbix-plugin&quot;, &quot;zabbix&quot;, &quot;15672&quot;,120000);
    } catch (IOException e) {
      e.printStackTrace();
    } catch (TimeoutException e) {
      e.printStackTrace();
    } catch (NotFoundException e) {
      e.printStackTrace();
    }
</code></pre>

<p>Make sure to use the correct arguments' values. A description is provided in the following:  </p>
<table>
<thead>
<tr>
<th>Argument value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>brokerIp</td>
<td>IP of RabbitMQ (broker)</td>
</tr>
<tr>
<td>username</td>
<td>Username for RabbitMQ</td>
</tr>
<tr>
<td>password</td>
<td>Password for RabbitMQ</td>
</tr>
<tr>
<td>5672</td>
<td>RabbitMQ default port (change it if needed)</td>
</tr>
<tr>
<td>zabbix-plugin</td>
<td>Type of the Monitoring Plugin</td>
</tr>
<tr>
<td>zabbix</td>
<td>Name of the Monitoring Plugin</td>
</tr>
<tr>
<td>15672</td>
<td>RabbitMQ default management port</td>
</tr>
<tr>
<td>120000</td>
<td>Timeout of the calls on the MonitoringPluginCaller</td>
</tr>
</tbody>
</table>
<h2 id="functionalities-provided-by-the-zabbix-plugin-interface">Functionalities provided by the Zabbix Plugin Interface</h2>
<h3 id="virtualisedresourceperformancemanagement-interface">VirtualisedResourcePerformanceManagement interface</h3>
<table>
<thead>
<tr>
<th>Methods</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>CREATE PM JOB</td>
<td>Create one or more items to be monitored in one or more hosts.</td>
</tr>
<tr>
<td>DELETE PM JOB</td>
<td>Delete a PM job.</td>
</tr>
<tr>
<td>QUERY PM JOB</td>
<td>Get item values from one or more host. Fast method since the item values are cached.</td>
</tr>
<tr>
<td>SUBSCRIBE</td>
<td>Subscribe to a pm job or a threshold in order to be notified.</td>
</tr>
<tr>
<td>NOTIFY</td>
<td>Notification method invoked by zabbix plugin, the customer must not invoke directly this method.</td>
</tr>
<tr>
<td>CREATE THRESHOLD</td>
<td>Create trigger on a specific item for one or more hosts</td>
</tr>
<tr>
<td>DELETE THRESHOLD</td>
<td>Delete a threshold.</td>
</tr>
<tr>
<td>QUERY THRESHOLD</td>
<td>Get information about the status of the thresholds</td>
</tr>
</tbody>
</table>
<h3 id="virtualisedresourcefaultmanagement-interface">VirtualisedResourceFaultManagement interface</h3>
<table>
<thead>
<tr>
<th>Methods</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>SUBSCRIBE</td>
<td>Subscribe for alarm coming from an host</td>
</tr>
<tr>
<td>NOTIFY</td>
<td>Notification method invoked by zabbix plugin, the customer must not invoke directly this method.</td>
</tr>
<tr>
<td>GET ALARM LIST</td>
<td>Get alarms and relative status</td>
</tr>
</tbody>
</table>
<h3 id="virtualisedresourceperformancemanagement-interface_1">VirtualisedResourcePerformanceManagement interface</h3>
<h4 id="create-pm-job">Create PM Job</h4>
<pre><code class="java">String createPMJob(ObjectSelection selector, List&lt;String&gt; performanceMetrics, List&lt;String&gt; performanceMetricGroup, Integer collectionPeriod,Integer reportingPeriod) throws MonitoringException;
</code></pre>

<p>This method create one or more items to be monitored in one or more hosts.</p>
<p><strong>selector</strong>: object to select the hosts in which we want to add the items.</p>
<p><strong>performanceMetrics</strong>: List of items. We can create items which are available in the <a href="https://www.zabbix.com/documentation/2.2/manual/config/items/itemtypes/zabbix_agent">Zabbix documentation 2.2</a> or [Zabbix documentation 3.0][zabbix-doc-3.0].</p>
<p><strong>performanceMetricGroup</strong>: pre-defined list of metrics. (NOT YET IMPLEMENTED, please pass an empty list of string).</p>
<p><strong>collectionPeriod</strong>: Update interval of the item/s in seconds.</p>
<p><strong>reportingPeriod</strong>: Specifies the periodicity at which the VIM will report to the customers about performance information. (NOT YET IMPLEMENTED, please pass an integer &gt;= 0 ).</p>
<p>In the following example we create two items ('net.tcp.listen[8080]' and 'agent.ping') for two hosts ('host-1' and 'host-2'). As a return value we get the ID of the PMJob.</p>
<pre><code class="java">ObjectSelection objectSelection = getObjectSelector(&quot;host-1&quot;,&quot;host-2&quot;);
List&lt;String&gt; performanceMetrics = getPerformanceMetrics(&quot;net.tcp.listen[8080]&quot;,&quot;agent.ping&quot;);
String pmJobId = monitoringPluginCaller.createPMJob(objectSelection, performanceMetrics, new ArrayList&lt;String&gt;(),60, 0);
System.out.println(&quot;PmJobId is: &quot;+pmJobId);
</code></pre>

<p>Here the methods getObjectSelector and getPerformanceMetrics:</p>
<pre><code class="java">private List&lt;String&gt; getPerformanceMetrics(String ... performanceMetrics) {
    List&lt;String&gt; result = new ArrayList&lt;String&gt;();
    for(String performanceMetric : performanceMetrics){
        result.add(performanceMetric);
    }
    return result;
}

private ObjectSelection getObjectSelector(String ... hosts) {
    ObjectSelection objectSelection = new ObjectSelection();
    for(String host : hosts){
        objectSelection.addObjectInstanceId(host);
    }
    return objectSelection;
}
</code></pre>

<h4 id="delete-pm-job">Delete Pm Job</h4>
<pre><code class="java">List&lt;String&gt; deletePMJob(List&lt;String&gt; pmJobIdsToDelete) throws MonitoringException;
</code></pre>

<p>This method delete an existing PmJob. We can get the id of the PmJob after the creation with createPMJob. As a return value we get the ID of the PMJobs effectively deleted.</p>
<h4 id="query-pm-job">Query Pm Job</h4>
<pre><code class="java">List&lt;Item&gt; queryPMJob(List&lt;String&gt; hostnames, List&lt;String&gt; performanceMetrics, String period) throws MonitoringException;
</code></pre>

<p>This method get item values from one or more host. As a return value we get the list of items.</p>
<p><strong>hostnames</strong>: list of hostnames which we want to know items values.</p>
<p><strong>performanceMetrics</strong>: List of items. We can get items which are available in: the <a href="https://www.zabbix.com/documentation/2.2/manual/config/items/itemtypes/zabbix_agent">Zabbix documentation 2.2</a>, [Zabbix documentation 3.0][zabbix-doc-3.0], and in the <strong>hostnames</strong>.</p>
<p><strong>period</strong>: period in seconds. If period is 0 than you get the last available value of the item. If &gt; 0 you get the average of the values inside that period.
    Remember than the zabbix-plugin read all value of the all hosts every <strong>client-request-frequency</strong> (see the configuration section) and keep them in the history.
    So if <strong>client-request-frequency</strong> is 15 seconds and the period 30 seconds you get the average of the previous 2 values of the item.</p>
<p>In the following example we ask for the last value of two items ('net.tcp.listen[8080]' and 'agent.ping') for the hosts 'host-1'.</p>
<pre><code class="java">ArrayList&lt;String&gt; hostnames = getHostnames(&quot;host-1&quot;);
ArrayList&lt;String&gt; performanceMetrics = getPerformanceMetrics(&quot;net.tcp.listen[8080]&quot;,&quot;agent.ping&quot;);
List&lt;Item&gt; items = monitoringPluginCaller.queryPMJob(hostnames,performanceMetrics,&quot;0&quot;);
</code></pre>

<p><strong>items</strong>: list of items. An item is a simple object of openbaton-libs which contains properties like: metric, hostname, lastValue, value.</p>
<h4 id="subscribe-notifyinfo">Subscribe &amp; notifyInfo</h4>
<p>NOT YET IMPLEMENTED</p>
<h4 id="create-threshold">Create Threshold</h4>
<pre><code class="java">String createThreshold(ObjectSelection selector, String performanceMetric, ThresholdType thresholdType, ThresholdDetails thresholdDetails) throws MonitoringException;
</code></pre>

<p>This method create a trigger on a specific item for one or more hosts. As a return value we get the id of the threshold.</p>
<p><strong>selector</strong>: object to select the hosts which will be part of the trigger.</p>
<p><strong>performanceMetric</strong>: item to include in the trigger. The item need to be already present in the hosts specified in the <em>selector</em>.</p>
<p><strong>thresholdType</strong>: defines the type of threshold. (NOT YET IMPLEMENTED, please pass ThresholdType.SINGLE for the moment).</p>
<p><strong>thresholdDetails</strong>: details of the threshold. It contains:</p>
<ul>
<li>function: refer to <a href="https://www.zabbix.com/documentation/2.2/manual/appendix/triggers/functions">Zabbix trigger function 2.2</a> or [Zabbix documentation 3.0][zabbix-trigger-function-3.0] </li>
<li>triggerOperator: operator</li>
<li>perceiverSeverity: severity of the trigger.</li>
<li>value: threshold value to compare with the actual value of the <em>performanceMetric</em>.</li>
<li>hostOperator: can be "|" or "&amp;", meaning that the threshold will trigger when at least one host or all the hosts cross the threshold value.</li>
</ul>
<p>In the following example we create a treshold for two hosts ('host-1' and 'host-2').</p>
<pre><code class="java">ObjectSelection objectSelector = getObjectSelector(&quot;host-1&quot;,&quot;host-2&quot;);
ThresholdDetails thresholdDetails= new ThresholdDetails(&quot;last(0)&quot;,&quot;=&quot;,PerceivedSeverity.CRITICAL,&quot;0&quot;,&quot;|&quot;);
String thresholdId = zabbixMonitoringAgent.createThreshold(objectSelector,&quot;net.tcp.listen[5001]&quot;,ThresholdType.SINGLE_VALUE,thresholdDetails);
</code></pre>

<p>The trigger that will be created has this expression: {host-1:net.tcp.listen[5001].last(0)}=0|{host-2:net.tcp.listen[5001].last(0)}=0.
It means that if host-1 OR host-2 have no more process listening on the port 5001 then create an alarm with severity critical.
Refer to <a href="https://www.zabbix.com/documentation/2.2/manual/config/triggers/expression">Zabbix expression 2.2</a> or [Zabbix expression 3.0][zabbix-trigger-expression-3.0] to understand better the expression.</p>
<h4 id="delete-threshold">Delete Threshold</h4>
<pre><code class="java">List&lt;String&gt; deleteThreshold(List&lt;String&gt; thresholdIds) throws MonitoringException;
</code></pre>

<p>This method delete an existing threshold/s. We can get the id of the threshold after the creation with createThreshold. As a return value we get the list of the ID of the threshold effectively deleted.</p>
<h4 id="query-threshold">Query Threshold</h4>
<p>NOT YET IMPLEMENTED</p>
<h3 id="virtualisedresourcefaultmanagement-interface_1">VirtualisedResourceFaultManagement interface</h3>
<h4 id="subscribe">Subscribe</h4>
<pre><code class="java">String subscribeForFault(AlarmEndpoint filter) throws MonitoringException;
</code></pre>

<p>Subscribe for alarm generated by thresholds. As a return value we get the id of the subscription.
<strong>filter</strong>: AlarmEndpoint object which contains:
-  name: name of the alarmEndpoint.
-  resourceId: hostname which we want to subscribe.
-  type: REST or JMS.
-  endpoint: endpoint where we want to be notified. It is and url for REST or a queue name for JMS. (actually only rest is supported).
-  perceivedSeverity: define the severity of the alarm we want to get.
    If we specify PerceivedSeverity.WARNING we will able to get notification from alarm with severity equals or higher than WARNING.</p>
<p>In the following example we subscribe for all alarms with severity higher than WARNING coming from the host 'host-1'.</p>
<pre><code class="java">AlarmEndpoint alarmEndpoint = new AlarmEndpoint(&quot;fault-manager-of-host-1&quot;,&quot;host-1&quot;,EndpointType.REST,&quot;http://localhost:5555/alarm&quot;,PerceivedSeverity.WARNING);
String subscriptionId = monitoringPluginCaller.subscribeForFault(alarmEndpoint);
</code></pre>

<h4 id="unsubscribe">Unsubscribe</h4>
<pre><code class="java">String unsubscribeForFault(String subscriptionId) throws MonitoringException;
</code></pre>

<p>This method detele the subscription with the ID passed as a argument. As a return value we get the id of the subscription effectively deleted.
We can get the id of the subscription after the creation with subscribeForFault.</p>
<h4 id="get-alarm-list">Get alarm list</h4>
<p>NOT YET IMPLEMENTED</p>
<h4 id="notify">Notify</h4>
<p>This method cannot be invoked by the customers as specified in the ETSI draft <a href="http://www.etsi.org/deliver/etsi_gs/NFV-IFA/001_099/005/02.01.01_60/gs_nfv-ifa005v020101p.pdf">IFA005_Or-Vi_ref_point_Spec</a>.</p>
<h2 id="zabbix-severity-mapping-with-etsi-severity">Zabbix severity mapping with ETSI severity</h2>
<p>In Zabbix we can specify a severity of a trigger: not classified, information, warning, average, high, disaster.</p>
<p>In the ETSI draft there are different level of severity, called perceived severity: Indeterminate, warning, minor, major, critical.</p>
<p>So the mapping in the zabbix plugin is showed in the following table:</p>
<table>
<thead>
<tr>
<th>Zabbix severity</th>
<th>ETSI perceived severity</th>
</tr>
</thead>
<tbody>
<tr>
<td>Not classified</td>
<td>Indeterminate</td>
</tr>
<tr>
<td>Information</td>
<td>Warning</td>
</tr>
<tr>
<td>Warning</td>
<td>Warning</td>
</tr>
<tr>
<td>Average</td>
<td>Minor</td>
</tr>
<tr>
<td>High</td>
<td>Major</td>
</tr>
<tr>
<td>Disaster</td>
<td>Critical</td>
</tr>
</tbody>
</table>
<h2 id="notifications-types">Notifications types</h2>
<p>When we create a new threshold, we would like to get a notification as soon as the threshold is crossed. Both interfaces send notifications with the method notify.
According to ETSI specification there are 4 types of notifications. </p>
<p>The interface VirtualisedResourcePerformanceManagement sends two types of notifications:  </p>
<ol>
<li>PerformanceInformationAvailableNotification (NOT YET IMPLEMENTED) : this notification informs the receiver that performance information is available.     </li>
<li>hresholdCrossedNotification (NOT YET IMPLEMENTED) : his notification informs the receiver that a threshold value has been crossed.  </li>
</ol>
<p>The interface VirtualisedResourceFaultManagement sends the following notifications:</p>
<ol>
<li>AlarmNotification: This notification informs the receiver of alarms resulting from the faults related to the virtualised resources managed by the VIM. It contains the Alarm with all the information about the fault.</li>
<li>AlarmStateChangedNotification: This notification informs the receiver of state change of alarm related to the virtualised resources managed by the VIM, e.g. the alarm shall be set to “cleared” if the corresponding fault has been solved.
    It contains the id of the Alarm and the actual status which could be (CLEARED,FIRED,UPDATED).</li>
</ol>
<p>Actually the zabbix-plugin when receives the notification by zabbix server, <strong>if the trigger has severity higher than Information</strong>, 
it creates an alarm (mapping zabbix notification into standard Alarm) and notify the subscribers with a AlarmNotification. If the notification is not new, then it sends an AlarmStateChangedNotification.</p>
                        
                      </div>
                    </div>
                    <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../autoscaling/" class="btn btn-neutral float-right" title="Autoscaling overview">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../monitoring/" class="btn btn-neutral" title="Monitoring overview"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright (c) 2016 Open Baton (http://www.openbaton.org)</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          	  
                  </div>
                </div>

        </section>
    </div>
  </div>
</div>



</body>
</html>

